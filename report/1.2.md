# 1.2 单周期 CPU 模块详细设计

（要求：各个模块的详细设计图，要包含内部的子模块，以及关键性逻辑，标出信号名和位宽，并有详细说明）

## 取指模块

![single_cycle_IF](../_images/single_cycle_IF.png)

IROM：指令存储器。

PC：

![single_cycle_PC.impl](../_images/single_cycle_PC.impl.png)

在时钟上升沿，若 ~rst_n 为 0，则寄存器更新为输入 pc 值 din；若 ~rst_n 为 1，则寄存器初始化为 -4。

NPC：

![single_cycle_NPC.impl](../_images/single_cycle_NPC.impl.png)

根据 op 控制信号决定 npc 的输出。npc 共有三个来源，分别为 pc + 4、 pc + imm、rd1 + imm。

同时，输出后续计算所需数据：pc + 4。

## 译指/写回模块

![single_cycle_ID](../_images/single_cycle_ID.png)

SEXT：

（数据的拼接过于复杂故图略）

![single_cycle_SEXT.impl](../_images/single_cycle_SEXT.impl.png)

立即数扩展单元，根据控制信号对指令中的立即数进行扩展。

RF：对 32 位指令 inst 进行解析，得到两个读取地址 rR1、rR2 和一个写入地址 wR，通过组合逻辑读出对应地址信号 rD1(RF[rR1])、rD2(RF[rR2])。

MUX4_1：多路选择器，选择写入 RF 的数据。其写入数据通过四选一选择器对数据进行选择，其写入数据包括：运算器结果 ALU.C、存储器读出结果 DRAM.rd、pc + 4、拓展后的立即数 SEXT.ext，由 wb_sel 信号决定写入数据，由 rf_we 信号决定是否写入。

## 运算模块

![single_cycle_EX](../_images/single_cycle_EX.png)

MUX2_1：选择器，选择写入 ALU.B 端口的数据。

ALU：

（SUB 计算的部分简化了，本来应该是 A + (~B) + 1）

![single_cycle_ALU.impl](../_images/single_cycle_ALU.impl.png)

进行各种运算，并根据 alu_op 选择所需的运算结果。其中包括加、减、按位与、按位或、按位异或、逻辑右移、逻辑左移、算术右移运算模块。输出计算结果是否为 0，以及正负数的信号。

## 存储模块

![single_cycle_MEM](../_images/single_cycle_MEM.png)

DRAM：数据存储器，用于存储数据。