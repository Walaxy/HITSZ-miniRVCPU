# 实验报告

## 总览

### 设计的功能描述（含所有实现的指令描述，以及单周期/流水线 CPU 频率）

1. 实现指令

   单周期与流水线 CPU 实现指令相同，为 24 条基础指令

2. 指令描述

|   单周期   |                                                            |
| :--------: | :--------------------------------------------------------: |
| **R-类型** |                                                            |
|    add     |                    (rd) ← (rs1) + (rs2)                    |
|    sub     |                    (rd) ← (rs1) - (rs2)                    |
|    and     |                   (rd) ← (rs1) &  (rs2)                    |
|     or     |                   (rd) ← (rs1) \| (rs2)                    |
|    xor     |                    (rd) ← (rs1) ^ (rs2)                    |
|    sll     |                   (rd) ← (rs1) <<  (rs2)                   |
|    srl     |              (rd) ← (rs1) >>  (rs2), 逻辑右移              |
|    sra     |              (rd) ← (rs1) >>  (rs2), 算术右移              |
| **I-类型** |                                                            |
|    addi    |                 (rd) ← (rs1) +  sext(imm)                  |
|    andi    |                 (rd) ← (rs1) &  sext(imm)                  |
|    ori     |                 (rd) ← (rs1) \|  sext(imm)                 |
|    xori    |                 (rd) ← (rs1) ^  sext(imm)                  |
|    slli    |                   (rd) ← (rs1) <<  shamt                   |
|    srli    |              (rd) ← (rs1) >>  shamt, 逻辑右移              |
|    srai    |              (rd) ← (rs1) >>  shamt, 算术右移              |
|     lw     |       (rd) ← sext(Mem[(rs1)  + sext(offset)][31:0])        |
|    jalr    | t ← (pc) + 4; (pc) ← ((rs1) + sext(offset)) & ~1; (rd) ← t |
| **S-类型** |                                                            |
|     sw     |          Mem[(rs1) + sext(offset)] ← (rs2)[31:0]           |

|   多周期   |                                                            |
| :--------: | :--------------------------------------------------------: |
| **R-类型** |                                                            |
|    add     |                    (rd) ← (rs1) + (rs2)                    |
|    sub     |                    (rd) ← (rs1) - (rs2)                    |
|    and     |                   (rd) ← (rs1) &  (rs2)                    |
|     or     |                   (rd) ← (rs1) \| (rs2)                    |
|    xor     |                    (rd) ← (rs1) ^ (rs2)                    |
|    sll     |                   (rd) ← (rs1) <<  (rs2)                   |
|    srl     |              (rd) ← (rs1) >>  (rs2), 逻辑右移              |
|    sra     |              (rd) ← (rs1) >>  (rs2), 算术右移              |
|   I-类型   |                                                            |
|    addi    |                 (rd) ← (rs1) +  sext(imm)                  |
|    andi    |                 (rd) ← (rs1) &  sext(imm)                  |
|    ori     |                 (rd) ← (rs1) \|  sext(imm)                 |
|    xori    |                 (rd) ← (rs1) ^  sext(imm)                  |
|    slli    |                   (rd) ← (rs1) <<  shamt                   |
|    srli    |              (rd) ← (rs1) >>  shamt, 逻辑右移              |
|    srai    |              (rd) ← (rs1) >>  shamt, 算术右移              |
|     lw     |       (rd) ← sext(Mem[(rs1)  + sext(offset)][31:0])        |
|    jalr    | t ← (pc) + 4; (pc) ← ((rs1) + sext(offset)) & ~1; (rd) ← t |
| **S-类型** |                                                            |
|     sw     |          Mem[(rs1) + sext(offset)] ← (rs2)[31:0]           |
| **B-类型** |                                                            |
|    beq     |       if ((rs1) = (rs2)) (pc) ← (pc) + sext(offset)        |
|    bne     |       if ((rs1) ≠ (rs2)) (pc) ← (pc) + sext(offset)        |
|    blt     | if ((rs1) < (rs2)) (pc) ← (pc) + sext(offset), 有符号比较  |
|    bge     | if ((rs1) ≥ (rs2)) (pc) ← (pc) + sext(offset), 有符号比较  |
| **U-类型** |                                                            |
|    lui     |               (rd) ← sext(imm[31:12]  << 12)               |
| **J-类型** |                                                            |
|    jal     |        (rd) ← (pc) + 4; (pc) ← (pc) + sext(offset)         |

### 设计的主要特色（除基本要求以外的设计）

### 资源使用情况、功耗数据截图（实现后）

## 1 单周期 CPU 设计与实现

### 1.1 单周期 CPU 整体框图

（要求：无需画出模块内的逻辑，但要标出模块之间信号线的信号名和位宽，以 及说明每个模块的功能含义）

图

模块说明：

1. 取指模块
  - PC：更新当前 PC 值
  - NPC：得到下一条指令的 PC 值
  - IROM：指令存储器，根据 PC 值得到对应的指令
2. 译指模块
  - RF：寄存器堆，可根据地址读出或写入对应寄存器数据
  - SEXT：立即数扩展单元据控制信号对指令中立即数进行扩展
  - MUX4_1：多路选择器，选择写入 RF 的数据
3. 执行模块
  - ALU：运算器，根据控制信号执行加、减、比较、移位等运算
  - MUX2_1：选择器，选择写入 ALU.B 端口的数据
4. 存储模块
  - DRAM：数据存储器，用于存储数据
5. 控制模块
  - CONTROLLER：控制器，根据指令得到各个器件的控制信号

### 1.2 单周期 CPU 模块详细设计

（要求：各个模块的详细设计图，要包含内部的子模块，以及关键性逻辑，标出信 号名和位宽，并有详细说明）

1.  取指模块
2. 译指模块
3. 运算模块
4. 存储模块

### 1.3 单周期 CPU 仿真及结果分析

（要求：包含逻辑运算指令、访存指令、跳转指令的仿真截图，以及结果分析）

1. 逻辑运算指令
2. 访存指令
3. 跳转指令

## 2 流水线 CPU 设计与实现

### 2.1 流水线的划分

（要求：画出流水线的划分，并标明每个阶段 CPU 完成的功能）

### 2.2 流水线 CPU 整体框图

（要求：无需画出模块内的逻辑，但要标出模块之间信号线的信号名和位宽，以 及说明每个模块的功能含义）

### 2.3 流水线 CPU 模块详细设计

（要求：各个模块的详细设计图，要包含内部的子模块，以及关键性逻辑，标出 信号名和位宽，并有详细说明；数据冒险与控制冒险的解决方法必须要详细说明）

### 2.4 流水线 CPU 仿真及结果分析

（要求：包含数据冒险、控制冒险的仿真截图，以及结果分析）

## 3 设计过程中遇到的问题及解决方法

（包括设计过程中的错误及测试过程中遇到的问题）

## 4 总结

（要求：个人收获以及对课程的建议）